(function(g,C){typeof exports=="object"&&typeof module!="undefined"?C(exports):typeof define=="function"&&define.amd?define(["exports"],C):(g=typeof globalThis!="undefined"?globalThis:g||self,C(g.modernScreenshot={}))})(this,function(g){var Fe;"use strict";var Xt=Object.defineProperty,Gt=Object.defineProperties;var Yt=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var Be=Math.pow,Ue=(g,C,T)=>C in g?Xt(g,C,{enumerable:!0,configurable:!0,writable:!0,value:T}):g[C]=T,x=(g,C)=>{for(var T in C||(C={}))_e.call(C,T)&&Ue(g,T,C[T]);if(Q)for(var T of Q(C))$e.call(C,T)&&Ue(g,T,C[T]);return g},M=(g,C)=>Gt(g,Yt(C));var Le=(g,C)=>{var T={};for(var N in g)_e.call(g,N)&&C.indexOf(N)<0&&(T[N]=g[N]);if(g!=null&&Q)for(var N of Q(g))C.indexOf(N)<0&&$e.call(g,N)&&(T[N]=g[N]);return T};var S=(g,C,T)=>new Promise((N,O)=>{var V=D=>{try{j(T.next(D))}catch(q){O(q)}},W=D=>{try{j(T.throw(D))}catch(q){O(q)}},j=D=>D.done?N(D.value):Promise.resolve(D.value).then(V,W);j((T=T.apply(g,C)).next())});function C(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}const T="p".charCodeAt(0),N="H".charCodeAt(0),O="Y".charCodeAt(0),V="s".charCodeAt(0);let W;function j(){const e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let r=0;r<8;r++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e}function D(e){let t=-1;W||(W=j());for(let n=0;n<e.length;n++)t=W[(t^e[n])&255]^t>>>8;return t^-1}function q(e){const t=e.length-1;for(let n=t;n>=4;n--)if(e[n-4]===9&&e[n-3]===T&&e[n-2]===N&&e[n-1]===O&&e[n]===V)return n-3;return 0}function re(e,t,n=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=T,r[1]=N,r[2]=O,r[3]=V,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=t&255,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const a=D(r),s=new Uint8Array(4);if(s[0]=a>>>24,s[1]=a>>>16,s[2]=a>>>8,s[3]=a&255,n){const o=q(e);return e.set(r,o),e.set(s,o+13),e}else{const o=new Uint8Array(4);o[0]=0,o[1]=0,o[2]=0,o[3]=9;const c=new Uint8Array(54);return c.set(e,0),c.set(o,33),c.set(r,37),c.set(s,50),c}}const Me="AAlwSFlz",Oe="AAAJcEhZ",We="AAAACXBI";function je(e){let t=e.indexOf(Me);return t===-1&&(t=e.indexOf(Oe)),t===-1&&(t=e.indexOf(We)),t}const Z="[modern-screenshot]",R=typeof window!="undefined",qe=R&&"Worker"in window,oe=R&&"atob"in window,Ve=R&&"btoa"in window,ee=R?(Fe=window.navigator)==null?void 0:Fe.userAgent:"",ae=ee.includes("Chrome"),H=ee.includes("AppleWebKit")&&!ae,se=ee.includes("Firefox"),He=e=>e&&"__CONTEXT__"in e,ze=e=>e.constructor.name==="CSSFontFaceRule",Xe=e=>e.constructor.name==="CSSImportRule",I=e=>e.nodeType===1,F=e=>typeof e.className=="object",Ge=e=>F(e)&&e.tagName==="svg",ie=e=>F(e)&&e.tagName==="image",te=e=>I(e)&&typeof e.style!="undefined"&&!F(e),Ye=e=>e.nodeType===8,Je=e=>e.nodeType===3,U=e=>e.tagName==="IMG",z=e=>e.tagName==="VIDEO",Ke=e=>e.tagName==="CANVAS",ce=e=>e.tagName==="TEXTAREA",Qe=e=>e.tagName==="INPUT",Ze=e=>e.tagName==="STYLE",et=e=>e.tagName==="SCRIPT",tt=e=>e.tagName==="SELECT",nt=e=>e.tagName==="SLOT",rt=e=>e.tagName==="IFRAME",v=(...e)=>console.warn(Z,...e),ot=e=>console.time(`${Z} ${e}`),at=e=>console.timeEnd(`${Z} ${e}`),st=e=>{var n;const t=(n=e==null?void 0:e.createElement)==null?void 0:n.call(e,"canvas");return t&&(t.height=t.width=1),t&&"toDataURL"in t&&Boolean(t.toDataURL("image/webp").includes("image/webp"))},ne=e=>e.startsWith("data:");function le(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(R&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!R)return e;const n=X().implementation.createHTMLDocument(),r=n.createElement("base"),a=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(a),t&&(r.href=t),a.href=e,a.href}function X(e){var t;return(t=e&&I(e)?e==null?void 0:e.ownerDocument:e)!=null?t:window.document}const G="http://www.w3.org/2000/svg";function ue(e,t,n){const r=X(n).createElementNS(G,"svg");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),r}function de(e){const t=new XMLSerializer().serializeToString(e).replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/ug,"");return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`}function it(e,t="image/png",n=1){return S(this,null,function*(){try{return yield new Promise((r,a)=>{e.toBlob(s=>{s?r(s):a(new Error("Blob is null"))},t,n)})}catch(r){if(oe)return v("Failed canvas to blob",{type:t,quality:n},r),ct(e.toDataURL(t,n));throw r}})}function ct(e){var c,i;const[t,n]=e.split(","),r=(i=(c=t.match(/data:(.+);/))==null?void 0:c[1])!=null?i:void 0,a=window.atob(n),s=a.length,o=new Uint8Array(s);for(let l=0;l<s;l+=1)o[l]=a.charCodeAt(l);return new Blob([o],{type:r})}function fe(e,t){return new Promise((n,r)=>{const a=new FileReader;a.onload=()=>n(a.result),a.onerror=()=>r(a.error),a.onabort=()=>r(new Error(`Failed read blob to ${t}`)),t==="dataUrl"?a.readAsDataURL(e):t==="arrayBuffer"&&a.readAsArrayBuffer(e)})}const lt=e=>fe(e,"dataUrl"),ut=e=>fe(e,"arrayBuffer");function P(e,t){const n=X(t).createElement("img");return n.decoding="sync",n.loading="eager",n.src=e,n}function _(e,t){return new Promise(n=>{const{timeout:r,ownerDocument:a,onError:s}=t!=null?t:{},o=typeof e=="string"?P(e,X(a)):e;let c=null,i=null;function l(){n(o),c&&clearTimeout(c),i==null||i()}if(r&&(c=setTimeout(l,r)),z(o)){const u=o.currentSrc||o.src;if(!u)return o.poster?_(o.poster,t).then(n):l();if(o.readyState>=2)return l();const d=l,f=m=>{v("Failed video load",u,m),s==null||s(m),l()};i=()=>{o.removeEventListener("loadeddata",d),o.removeEventListener("error",f)},o.addEventListener("loadeddata",d,{once:!0}),o.addEventListener("error",f,{once:!0})}else{const u=ie(o)?o.href.baseVal:o.currentSrc||o.src;if(!u)return l();const d=()=>S(this,null,function*(){if(U(o)&&"decode"in o)try{yield o.decode()}catch(m){v("Failed to decode image, trying to render anyway",o.dataset.originalSrc||u,m)}l()}),f=m=>{v("Failed image load",o.dataset.originalSrc||u,m),l()};if(U(o)&&o.complete)return d();i=()=>{o.removeEventListener("load",d),o.removeEventListener("error",f)},o.addEventListener("load",d,{once:!0}),o.addEventListener("error",f,{once:!0})}})}function me(e,t){return S(this,null,function*(){te(e)&&(U(e)||z(e)?yield _(e,{timeout:t}):yield Promise.all(["img","video"].flatMap(n=>Array.from(e.querySelectorAll(n)).map(r=>_(r,{timeout:t})))))})}const ge=function(){let t=0;const n=()=>`0000${(Math.random()*Be(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function he(e){return e==null?void 0:e.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}function dt(e){return{time:t=>e&&ot(t),timeEnd:t=>e&&at(t),warn:(...t)=>e&&v(...t)}}function ft(e){return{cache:e?"no-cache":"force-cache"}}function k(e,t){return S(this,null,function*(){return He(e)?e:we(e,M(x({},t),{autoDestruct:!0}))})}function we(e,t){return S(this,null,function*(){var f,m,w,y;const{scale:n=1,workerUrl:r,workerNumber:a=1}=t||{},s=Boolean(t==null?void 0:t.debug),o=(f=e.ownerDocument)!=null?f:R?window.document:void 0,c=(w=(m=e.ownerDocument)==null?void 0:m.defaultView)!=null?w:R?window:void 0,i=new Map,l=M(x({width:0,height:0,quality:1,type:"image/png",scale:n,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:s,fetch:x({requestInit:ft((y=t==null?void 0:t.fetch)==null?void 0:y.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},t==null?void 0:t.fetch),font:{},drawImageInterval:100,workerUrl:null,workerNumber:a,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:dt(s),node:e,ownerDocument:o,ownerWindow:c,dpi:n===1?null:96*n,svgStyleElement:pe(o),svgDefsElement:o==null?void 0:o.createElementNS(G,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...new Array(qe&&r&&a?a:0)].map(()=>{try{const b=new Worker(r);return b.onmessage=h=>S(this,null,function*(){var A,B,L,Pe;const{url:E,result:p}=h.data;p?(B=(A=i.get(E))==null?void 0:A.resovle)==null||B.call(A,p):(Pe=(L=i.get(E))==null?void 0:L.reject)==null||Pe.call(L,new Error(`Error receiving message from worker: ${E}`))}),b.onmessageerror=h=>{var p,A;const{url:E}=h.data;(A=(p=i.get(E))==null?void 0:p.reject)==null||A.call(p,new Error(`Error receiving message from worker: ${E}`))},b}catch(b){return v("Failed to new Worker",b),null}}).filter(Boolean),fontFamilies:new Set,fontCssTexts:new Map,acceptOfImage:`${[st(o)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:i,drawImageCount:0,tasks:[]});l.log.time("wait until load"),yield me(e,l.timeout),l.log.timeEnd("wait until load");const{width:u,height:d}=mt(e,l);return l.width=u,l.height=d,l})}function pe(e){if(!e)return;const t=e.createElement("style"),n=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(n),t}function mt(e,t){let{width:n,height:r}=t;if(I(e)&&(!n||!r)){const a=e.getBoundingClientRect();n=n||a.width||Number(e.getAttribute("width"))||0,r=r||a.height||Number(e.getAttribute("height"))||0}return{width:n,height:r}}function gt(e,t){return S(this,null,function*(){const{log:n,timeout:r,drawImageCount:a,drawImageInterval:s}=t;n.time("image to canvas");const o=yield _(e,{timeout:r}),{canvas:c,context2d:i}=ht(e.ownerDocument,t),l=()=>{try{i==null||i.drawImage(o,0,0,c.width,c.height)}catch(u){v("Failed to drawImage",u)}};l();for(let u=0;u<a;u++)yield new Promise(d=>{setTimeout(()=>{l(),d()},u+s)});return t.drawImageCount=0,n.timeEnd("image to canvas"),c})}function ht(e,t){const{width:n,height:r,scale:a,backgroundColor:s,maximumCanvasSize:o}=t,c=e.createElement("canvas");c.width=Math.floor(n*a),c.height=Math.floor(r*a),c.style.width=`${n}px`,c.style.height=`${r}px`,o&&(c.width>o||c.height>o)&&(c.width>o&&c.height>o?c.width>c.height?(c.height*=o/c.width,c.width=o):(c.width*=o/c.height,c.height=o):c.width>o?(c.height*=o/c.width,c.width=o):(c.width*=o/c.height,c.height=o));const i=c.getContext("2d");return i&&s&&(i.fillStyle=s,i.fillRect(0,0,c.width,c.height)),{canvas:c,context2d:i}}const wt=["width","height"],pt=["stroke","fill"];function ye(e,t,n){var b;const{defaultComputedStyles:r,ownerDocument:a}=n,s=e.nodeName.toLowerCase(),o=F(e)&&s!=="svg",c=o?pt.map(h=>[h,e.getAttribute(h)]).filter(([,h])=>h!==null):[],i=[o&&"svg",s,c.map((h,E)=>`${h}=${E}`).join(","),t].filter(Boolean).join(":");if(r.has(i))return r.get(i);let l=n.sandbox;if(!l)try{a&&(l=a.createElement("iframe"),l.id=`__SANDBOX__-${ge()}`,l.width="0",l.height="0",l.style.visibility="hidden",l.style.position="fixed",a.body.appendChild(l),(b=l.contentWindow)==null||b.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),n.sandbox=l)}catch(h){v("Failed to create iframe sandbox",h)}if(!l)return new Map;const u=l.contentWindow;if(!u)return new Map;const d=u.document;let f,m;o?(f=d.createElementNS(G,"svg"),m=f.ownerDocument.createElementNS(f.namespaceURI,s),c.forEach(([h,E])=>{m.setAttributeNS(null,h,E)}),f.appendChild(m)):f=m=d.createElement(s),m.textContent=" ",d.body.appendChild(f);const w=u.getComputedStyle(m,t),y=new Map;for(let h=w.length,E=0;E<h;E++){const p=w.item(E);wt.includes(p)||y.set(p,w.getPropertyValue(p))}return d.body.removeChild(f),r.set(i,y),y}function be(e,t){var s;const n=new Map,r=[],a=new Map;for(let o=e.length,c=0;c<o;c++){const i=e.item(c),l=e.getPropertyValue(i),u=e.getPropertyPriority(i),d=i.lastIndexOf("-"),f=d>-1?i.substring(0,d):void 0;if(f){let m=a.get(f);m||(m=new Map,a.set(f,m)),m.set(i,[l,u])}t.get(i)===l&&!u||(f?r.push(f):n.set(i,[l,u]))}for(let o=r.length,c=0;c<o;c++)(s=a.get(r[c]))==null||s.forEach((i,l)=>n.set(l,i));return n}const yt=[":before",":after"],bt=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function St(e,t,n,r){const{ownerWindow:a,svgStyleElement:s,svgStyles:o}=r;if(!s||!a)return;function c(i){var h;const l=a.getComputedStyle(e,i);let u=l.getPropertyValue("content");if(!u||u==="none")return;u=u.replace(/(')|(")|(counter\(.+\))/g,"");const d=[ge()],f=ye(e,i,r),m=[`content: '${u}';`],w=be(l,f);if(w.delete("content"),w.delete("-webkit-locale"),((h=w.get("background-clip"))==null?void 0:h[0])==="text"&&t.classList.add("______background-clip--text"),w.forEach(([E,p],A)=>{m.push(`${A}: ${E}${p?" !important":""};`)}),m.length===1)return;try{t.className=[t.className,...d].join(" ")}catch(E){return}const y=m.join(`
  `);let b=o.get(y);b||(b=[],o.set(y,b)),b.push(`.${d[0]}:${i}`)}yt.forEach(c),n&&bt.forEach(c)}function Et(e,t){ce(e)&&(t.innerHTML=e.value),(ce(e)||Qe(e)||tt(e))&&t.setAttribute("value",e.value)}function Ct(e,t,n,r){var l,u,d,f;const{ownerWindow:a}=r,s=t.style,o=a.getComputedStyle(e),c=ye(e,null,r),i=be(o,c);return i.delete("transition-property"),i.delete("all"),i.delete("d"),i.delete("content"),n&&(i.delete("margin-top"),i.delete("margin-right"),i.delete("margin-bottom"),i.delete("margin-left"),i.delete("margin-block-start"),i.delete("margin-block-end"),i.delete("margin-inline-start"),i.delete("margin-inline-end"),i.set("box-sizing",["border-box",""])),((l=i.get("background-clip"))==null?void 0:l[0])==="text"&&t.classList.add("______background-clip--text"),ae&&(i.has("font-kerning")||i.set("font-kerning",["normal",""]),(((u=i.get("overflow-x"))==null?void 0:u[0])==="hidden"||((d=i.get("overflow-y"))==null?void 0:d[0])==="hidden")&&((f=i.get("text-overflow"))==null?void 0:f[0])==="ellipsis"&&e.scrollWidth===e.clientWidth&&i.set("text-overflow",["clip",""])),i.forEach(([m,w],y)=>{s.setProperty(y,m,w)}),i}function Tt(e,t){return S(this,null,function*(){var s,o,c;const{ownerDocument:n,svgDefsElement:r}=t,a=(o=(s=e.querySelectorAll)==null?void 0:s.call(e,"use"))!=null?o:[];if(a.length)for(let i=a.length,l=0;l<i;l++){const u=a[l],d=(c=u.getAttribute("xlink:href"))!=null?c:u.getAttribute("href");if(!d)continue;const f=n==null?void 0:n.querySelector(`svg ${d}`);!f||r!=null&&r.querySelector(d)||r==null||r.appendChild(yield Y(f,t))}return e.cloneNode(!1)})}function vt(e,t){var n;try{if((n=e==null?void 0:e.contentDocument)!=null&&n.body)return Y(e.contentDocument.body,t)}catch(r){v("Failed to clone iframe",r)}return e.cloneNode(!1)}function Se(e){if(e.ownerDocument)try{const a=e.toDataURL();if(a!=="data:,")return P(a,e.ownerDocument)}catch(a){}const t=e.cloneNode(!1),n=e.getContext("2d"),r=t.getContext("2d");try{return n&&r&&r.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(a){v("Failed to clone canvas",a)}return t}function At(e){return S(this,null,function*(){if(e.ownerDocument&&!e.currentSrc&&e.poster)return P(e.poster,e.ownerDocument);const t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);const n=t.ownerDocument;if(n){let r=!0;if(yield _(t,{onError:()=>r=!1}),!r)return e.poster?P(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,yield new Promise(s=>{t.addEventListener("seeked",s,{once:!0})});const a=n.createElement("canvas");a.width=e.offsetWidth,a.height=e.offsetHeight;try{const s=a.getContext("2d");s&&s.drawImage(t,0,0,a.width,a.height)}catch(s){return v("Failed to clone video",s),e.poster?P(e.poster,e.ownerDocument):t}return Se(a)}return t})}function Nt(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}function It(e,t){return Ke(e)?Se(e):rt(e)?vt(e,t):U(e)?Nt(e):z(e)?At(e):Ge(e)?Tt(e,t):e.cloneNode(!1)}function Ee(e,t,n){return S(this,null,function*(){I(t)&&(Ze(t)||et(t))||n.filter&&!n.filter(t)||e.appendChild(yield Y(t,n))})}function Ce(e,t,n){return S(this,null,function*(){var a,s;const r=(s=I(e)?(a=e.shadowRoot)==null?void 0:a.firstChild:void 0)!=null?s:e.firstChild;for(let o=r;o;o=o.nextSibling)if(!Ye(o))if(I(o)&&nt(o)&&typeof o.assignedNodes=="function"){const c=o.assignedNodes();for(let i=0;i<c.length;i++)yield Ee(t,c[i],n)}else yield Ee(t,o,n)})}function kt(e,t){const{backgroundColor:n,width:r,height:a,style:s}=t,o=e.style;if(n&&o.setProperty("background-color",n,"important"),r&&o.setProperty("width",`${r}px`,"important"),a&&o.setProperty("height",`${a}px`,"important"),s)for(const c in s)o[c]=s[c]}function Y(e,t,n=!1){return S(this,null,function*(){var c,i,l,u;const{ownerDocument:r,ownerWindow:a,fontFamilies:s}=t;if(r&&Je(e))return r.createTextNode(e.data);if(r&&a&&I(e)&&(te(e)||F(e))){const d=yield It(e,t);d.removeAttribute('"');const f=Ct(e,d,n,t);n&&kt(d,t);const m=[(c=f.get("overflow-x"))==null?void 0:c[0],(i=f.get("overflow-y"))==null?void 0:i[1]];return St(e,d,m.includes("scroll")||(m.includes("auto")||m.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth),t),Et(e,d),(u=he((l=f.get("font-family"))==null?void 0:l[0]))==null||u.forEach(w=>s.add(w)),z(e)||(yield Ce(e,d,t)),d}const o=e.cloneNode(!1);return yield Ce(e,o,t),o})}function Te(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(t){}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}function xt(e){const c=e,{url:t,timeout:n,responseType:r}=c,a=Le(c,["url","timeout","responseType"]),s=new AbortController,o=n?setTimeout(()=>s.abort(),n):void 0;return fetch(t,x({signal:s.signal},a)).then(i=>{if(!i.ok)throw new Error("Failed fetch, not 2xx response",{cause:i});switch(r){case"dataUrl":return i.blob().then(lt);case"text":default:return i.text()}}).finally(()=>clearTimeout(o))}function J(e,t){const{url:n,requestType:r="text",responseType:a="text",imageDom:s}=t;let o=n;const{timeout:c,acceptOfImage:i,requests:l,fetch:{requestInit:u,bypassingCache:d,placeholderImage:f},workers:m}=e;let w;if(l.has(n))w=l.get(n);else{d&&(o+=(/\?/.test(o)?"&":"?")+new Date().getTime()),r==="image"&&H&&e.drawImageCount++;const y=x({url:o,timeout:c,responseType:a,headers:r==="image"?{accept:i}:void 0},u);w={type:r,resovle:void 0,reject:void 0,response:null},w.response=(!H&&n.startsWith("http")&&m.length?new Promise((b,h)=>{m[l.size&m.length-1].postMessage(x({rawUrl:n},y)),w.resovle=b,w.reject=h}):xt(y)).catch(b=>{if(l.delete(n),r==="image"&&f)return v("Failed to fetch image base64, trying to use placeholder image",o),typeof f=="string"?f:f(s);throw b}),l.set(n,w)}return w.response}function ve(e,t,n,r){return S(this,null,function*(){if(!Ae(e))return e;for(const[a,s]of Dt(e,t))try{const o=yield J(n,{url:s,requestType:r?"image":"text",responseType:"dataUrl"});e=e.replace(Rt(a),`$1${o}$3`)}catch(o){v("Failed to fetch css data url",a,o)}return e})}function Ae(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const Ne=/url\((['"]?)([^'"]+?)\1\)/g;function Dt(e,t){const n=[];return e.replace(Ne,(r,a,s)=>(n.push([s,le(s,t)]),r)),n.filter(([r])=>!ne(r))}function Rt(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Ft(e,t){return S(this,null,function*(){const{ownerDocument:n,svgStyleElement:r,fontFamilies:a,fontCssTexts:s,tasks:o,font:c}=t;if(!(!n||!r||!a.size))if(c&&c.cssText){const i=ke(c.cssText,t);r.appendChild(n.createTextNode(`${i}
`))}else{const i=Array.from(n.styleSheets).filter(u=>{try{return"cssRules"in u&&Boolean(u.cssRules.length)}catch(d){return v(`Error while reading CSS rules from ${u.href}`,d),!1}});yield Promise.all(i.flatMap(u=>Array.from(u.cssRules).map((d,f)=>S(this,null,function*(){if(Xe(d)){let m=f+1;const w=d.href;let y="";try{y=yield J(t,{url:w,requestType:"text",responseType:"text"})}catch(h){v(`Error fetch remote css import from ${w}`,h)}const b=y.replace(Ne,(h,E,p)=>h.replace(p,le(p,w)));for(const h of Ut(b))try{u.insertRule(h,h.startsWith("@import")?m+=1:u.cssRules.length)}catch(E){v("Error inserting rule from remote css import",{rule:h,error:E})}}})))),i.flatMap(u=>Array.from(u.cssRules)).filter(u=>{var d;return ze(u)&&Ae(u.style.getPropertyValue("src"))&&((d=he(u.style.getPropertyValue("font-family")))==null?void 0:d.some(f=>a.has(f)))}).forEach(u=>{const d=u,f=s.get(d.cssText);f?r.appendChild(n.createTextNode(`${f}
`)):o.push(ve(d.cssText,d.parentStyleSheet?d.parentStyleSheet.href:null,t).then(m=>{m=ke(m,t),s.set(d.cssText,m),r.appendChild(n.createTextNode(`${m}
`))}))})}})}const Pt=/(\/\*[\s\S]*?\*\/)/gi,Ie=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function Ut(e){if(e==null)return[];const t=[];let n=e.replace(Pt,"");for(;;){const s=Ie.exec(n);if(!s)break;t.push(s[0])}n=n.replace(Ie,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,a=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let s=r.exec(n);if(s)a.lastIndex=r.lastIndex;else if(s=a.exec(n),s)r.lastIndex=a.lastIndex;else break;t.push(s[0])}return t}const _t=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,$t=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ke(e,t){const{font:n}=t,r=n?n==null?void 0:n.preferredFormat:void 0;return r?e.replace($t,a=>{for(;;){const[s,,o]=_t.exec(a)||[];if(!o)return"";if(o===r)return`src: ${s};`}}):e}function Bt(e,t){if(U(e)){const n=e.currentSrc||e.src;if(!ne(n))return[J(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.srcset="",e.dataset.originalSrc=n,e.src=r||"")})];(H||se)&&n.includes("data:image/svg+xml")&&t.drawImageCount++}else if(F(e)&&!ne(e.href.baseVal)){const n=e.href.baseVal;return[J(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.dataset.originalSrc=n,e.href.baseVal=r||"")})]}return[]}const Lt=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Mt(e,t){return Lt.map(n=>{const r=e.getPropertyValue(n);return r?((H||se)&&r.includes("data:image/svg+xml")&&t.drawImageCount++,ve(r,null,t,!0).then(a=>{!a||r===a||e.setProperty(n,a,e.getPropertyPriority(n))})):null}).filter(Boolean)}function xe(e,t){const{tasks:n}=t;I(e)&&(U(e)||ie(e))&&n.push(...Bt(e,t)),te(e)&&n.push(...Mt(e.style,t)),e.childNodes.forEach(r=>{xe(r,t)})}function De(e,t){return S(this,null,function*(){const n=yield k(e,t);if(I(n.node)&&F(n.node))return n.node;const{ownerDocument:r,log:a,tasks:s,svgStyleElement:o,svgDefsElement:c,svgStyles:i,font:l,progress:u,autoDestruct:d,onCloneNode:f,onEmbedNode:m,onCreateForeignObjectSvg:w}=n;a.time("clone node");const y=yield Y(n.node,n,!0);if(o&&r){let A="";i.forEach((B,L)=>{A+=`${B.join(`,
`)} {
  ${L}
}
`}),o.appendChild(r.createTextNode(A))}a.timeEnd("clone node"),f==null||f(y),l!==!1&&I(y)&&(a.time("embed web font"),yield Ft(y,n),a.timeEnd("embed web font")),a.time("embed node"),xe(y,n);const b=s.length;let h=0;const E=()=>S(this,null,function*(){for(;;){const A=s.pop();if(!A)break;try{yield A}catch(B){v("Failed to run task",B)}u==null||u(++h,b)}});u==null||u(h,b),yield Promise.all([...Array(4)].map(E)),a.timeEnd("embed node"),m==null||m(y);const p=Ot(y,n);return c&&p.insertBefore(c,p.children[0]),o&&p.insertBefore(o,p.children[0]),d&&Te(n),w==null||w(p),p})}function Ot(e,t){const{width:n,height:r}=t,a=ue(n,r,e.ownerDocument),s=a.ownerDocument.createElementNS(a.namespaceURI,"foreignObject");return s.setAttributeNS(null,"x","0%"),s.setAttributeNS(null,"y","0%"),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.append(e),a.appendChild(s),a}function K(e,t){return S(this,null,function*(){var o;const n=yield k(e,t),r=yield De(n),a=de(r);n.autoDestruct||(n.svgStyleElement=pe(n.ownerDocument),n.svgDefsElement=(o=n.ownerDocument)==null?void 0:o.createElementNS(G,"defs"),n.svgStyles.clear());const s=P(a,r.ownerDocument);return yield gt(s,n)})}function Wt(e,t){return S(this,null,function*(){const n=yield k(e,t),{log:r,type:a,quality:s,dpi:o}=n,c=yield K(n);r.time("canvas to blob");const i=yield it(c,a,s);if(["image/png","image/jpeg"].includes(a)&&o){const l=yield ut(i.slice(0,33));let u=new Uint8Array(l);return a==="image/png"?u=re(u,o):a==="image/jpeg"&&(u=C(u,o)),new Blob([u,i.slice(33)],{type:a})}return r.timeEnd("canvas to blob"),i})}function $(e,t){return S(this,null,function*(){const n=yield k(e,t),{log:r,quality:a,type:s,dpi:o}=n,c=yield K(n);r.time("canvas to data url");let i=c.toDataURL(s,a);if(["image/png","image/jpeg"].includes(s)&&o&&oe&&Ve){const[l,u]=i.split(",");let d=0,f=!1;if(s==="image/png"){const p=je(u);p>=0?(d=Math.ceil((p+28)/3)*4,f=!0):d=33/3*4}else s==="image/jpeg"&&(d=18/3*4);const m=u.substring(0,d),w=u.substring(d),y=window.atob(m),b=new Uint8Array(y.length);for(let p=0;p<b.length;p++)b[p]=y.charCodeAt(p);const h=s==="image/png"?re(b,o,f):C(b,o),E=window.btoa(String.fromCharCode(...h));i=[l,",",E,w].join("")}return r.timeEnd("canvas to data url"),i})}function Re(e,t){return S(this,null,function*(){const n=yield k(e,t),{width:r,height:a,ownerDocument:s}=n,o=yield $(n),c=ue(r,a,s),i=c.ownerDocument.createElementNS(c.namespaceURI,"image");return i.setAttributeNS(null,"href",o),i.setAttributeNS(null,"height","100%"),i.setAttributeNS(null,"width","100%"),c.appendChild(i),de(c)})}function jt(e,t){return S(this,null,function*(){const n=yield k(e,t),{ownerDocument:r,width:a,height:s,scale:o,type:c}=n,i=c==="image/svg+xml"?yield Re(n):yield $(n),l=P(i,r);return l.width=Math.floor(a*o),l.height=Math.floor(s*o),l.style.width=`${a}px`,l.style.height=`${s}px`,l})}function qt(e,t){return S(this,null,function*(){return $(yield k(e,M(x({},t),{type:"image/jpeg"})))})}function Vt(e,t){return S(this,null,function*(){const n=yield k(e,t),r=yield K(n);return r.getContext("2d").getImageData(0,0,r.width,r.height).data})}function Ht(e,t){return S(this,null,function*(){return $(yield k(e,M(x({},t),{type:"image/png"})))})}function zt(e,t){return S(this,null,function*(){return $(yield k(e,M(x({},t),{type:"image/webp"})))})}g.createContext=we,g.destroyContext=Te,g.domToBlob=Wt,g.domToCanvas=K,g.domToDataUrl=$,g.domToForeignObjectSvg=De,g.domToImage=jt,g.domToJpeg=qt,g.domToPixel=Vt,g.domToPng=Ht,g.domToSvg=Re,g.domToWebp=zt,g.loadMedia=_,g.waitUntilLoad=me,Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});
