"use strict";var _e=Object.defineProperty,$e=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var Q=Math.pow,Y=(e,t,n)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T=(e,t)=>{for(var n in t||(t={}))J.call(t,n)&&Y(e,n,t[n]);if(_)for(var n of _(t))K.call(t,n)&&Y(e,n,t[n]);return e},R=(e,t)=>$e(e,Be(t));var Z=(e,t)=>{var n={};for(var r in e)J.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&_)for(var r of _(e))t.indexOf(r)<0&&K.call(e,r)&&(n[r]=e[r]);return n};var b=(e,t,n)=>new Promise((r,a)=>{var i=s=>{try{c(n.next(s))}catch(l){a(l)}},o=s=>{try{c(n.throw(s))}catch(l){a(l)}},c=s=>s.done?r(s.value):Promise.resolve(s.value).then(i,o);c((n=n.apply(e,t)).next())});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function se(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}const ie="p".charCodeAt(0),ce="H".charCodeAt(0),le="Y".charCodeAt(0),ue="s".charCodeAt(0);let q;function Le(){const e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let r=0;r<8;r++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e}function Me(e){let t=-1;q||(q=Le());for(let n=0;n<e.length;n++)t=q[(t^e[n])&255]^t>>>8;return t^-1}function Oe(e){const t=e.length-1;for(let n=t;n>=4;n--)if(e[n-4]===9&&e[n-3]===ie&&e[n-2]===ce&&e[n-1]===le&&e[n]===ue)return n-3;return 0}function de(e,t,n=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=ie,r[1]=ce,r[2]=le,r[3]=ue,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=t&255,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const a=Me(r),i=new Uint8Array(4);if(i[0]=a>>>24,i[1]=a>>>16,i[2]=a>>>8,i[3]=a&255,n){const o=Oe(e);return e.set(r,o),e.set(i,o+13),e}else{const o=new Uint8Array(4);o[0]=0,o[1]=0,o[2]=0,o[3]=9;const c=new Uint8Array(54);return c.set(e,0),c.set(o,33),c.set(r,37),c.set(i,50),c}}const We="AAlwSFlz",je="AAAJcEhZ",qe="AAAACXBI";function Ve(e){let t=e.indexOf(We);return t===-1&&(t=e.indexOf(je)),t===-1&&(t=e.indexOf(qe)),t}const H="[modern-screenshot]",N=typeof window!="undefined",He=N&&"Worker"in window,fe=N&&"atob"in window,ze=N&&"btoa"in window;var ae;const z=N?(ae=window.navigator)==null?void 0:ae.userAgent:"",ge=z.includes("Chrome"),$=z.includes("AppleWebKit")&&!ge,me=z.includes("Firefox"),Xe=e=>e&&"__CONTEXT__"in e,Ge=e=>e.constructor.name==="CSSFontFaceRule",Ye=e=>e.constructor.name==="CSSImportRule",v=e=>e.nodeType===1,I=e=>typeof e.className=="object",Je=e=>I(e)&&e.tagName==="svg",he=e=>I(e)&&e.tagName==="image",X=e=>v(e)&&typeof e.style!="undefined"&&!I(e),Ke=e=>e.nodeType===8,Qe=e=>e.nodeType===3,F=e=>e.tagName==="IMG",L=e=>e.tagName==="VIDEO",Ze=e=>e.tagName==="CANVAS",ee=e=>e.tagName==="TEXTAREA",et=e=>e.tagName==="INPUT",tt=e=>e.tagName==="STYLE",nt=e=>e.tagName==="SCRIPT",rt=e=>e.tagName==="SELECT",ot=e=>e.tagName==="SLOT",at=e=>e.tagName==="IFRAME",E=(...e)=>console.warn(H,...e),st=e=>console.time(`${H} ${e}`),it=e=>console.timeEnd(`${H} ${e}`),ct=e=>{var n;const t=(n=e==null?void 0:e.createElement)==null?void 0:n.call(e,"canvas");return t&&(t.height=t.width=1),t&&"toDataURL"in t&&Boolean(t.toDataURL("image/webp").includes("image/webp"))},V=e=>e.startsWith("data:");function we(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(N&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!N)return e;const n=M().implementation.createHTMLDocument(),r=n.createElement("base"),a=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(a),t&&(r.href=t),a.href=e,a.href}function M(e){var t;return(t=e&&v(e)?e==null?void 0:e.ownerDocument:e)!=null?t:window.document}const O="http://www.w3.org/2000/svg";function pe(e,t,n){const r=M(n).createElementNS(O,"svg");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),r}function ye(e){const t=new XMLSerializer().serializeToString(e).replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/ug,"");return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`}function lt(e,t="image/png",n=1){return b(this,null,function*(){try{return yield new Promise((r,a)=>{e.toBlob(i=>{i?r(i):a(new Error("Blob is null"))},t,n)})}catch(r){if(fe)return E("Failed canvas to blob",{type:t,quality:n},r),ut(e.toDataURL(t,n));throw r}})}function ut(e){var c,s;const[t,n]=e.split(","),r=(s=(c=t.match(/data:(.+);/))==null?void 0:c[1])!=null?s:void 0,a=window.atob(n),i=a.length,o=new Uint8Array(i);for(let l=0;l<i;l+=1)o[l]=a.charCodeAt(l);return new Blob([o],{type:r})}function be(e,t){return new Promise((n,r)=>{const a=new FileReader;a.onload=()=>n(a.result),a.onerror=()=>r(a.error),a.onabort=()=>r(new Error(`Failed read blob to ${t}`)),t==="dataUrl"?a.readAsDataURL(e):t==="arrayBuffer"&&a.readAsArrayBuffer(e)})}const dt=e=>be(e,"dataUrl"),ft=e=>be(e,"arrayBuffer");function x(e,t){const n=M(t).createElement("img");return n.decoding="sync",n.loading="eager",n.src=e,n}function P(e,t){return new Promise(n=>{const{timeout:r,ownerDocument:a,onError:i}=t!=null?t:{},o=typeof e=="string"?x(e,M(a)):e;let c=null,s=null;function l(){n(o),c&&clearTimeout(c),s==null||s()}if(r&&(c=setTimeout(l,r)),L(o)){const u=o.currentSrc||o.src;if(!u)return o.poster?P(o.poster,t).then(n):l();if(o.readyState>=2)return l();const d=l,f=g=>{E("Failed video load",u,g),i==null||i(g),l()};s=()=>{o.removeEventListener("loadeddata",d),o.removeEventListener("error",f)},o.addEventListener("loadeddata",d,{once:!0}),o.addEventListener("error",f,{once:!0})}else{const u=he(o)?o.href.baseVal:o.currentSrc||o.src;if(!u)return l();const d=()=>b(this,null,function*(){if(F(o)&&"decode"in o)try{yield o.decode()}catch(g){E("Failed to decode image, trying to render anyway",o.dataset.originalSrc||u,g)}l()}),f=g=>{E("Failed image load",o.dataset.originalSrc||u,g),l()};if(F(o)&&o.complete)return d();s=()=>{o.removeEventListener("load",d),o.removeEventListener("error",f)},o.addEventListener("load",d,{once:!0}),o.addEventListener("error",f,{once:!0})}})}function Se(e,t){return b(this,null,function*(){X(e)&&(F(e)||L(e)?yield P(e,{timeout:t}):yield Promise.all(["img","video"].flatMap(n=>Array.from(e.querySelectorAll(n)).map(r=>P(r,{timeout:t})))))})}const Ee=function(){let t=0;const n=()=>`0000${(Math.random()*Q(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function Ce(e){return e==null?void 0:e.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}function gt(e){return{time:t=>e&&st(t),timeEnd:t=>e&&it(t),warn:(...t)=>e&&E(...t)}}function mt(e){return{cache:e?"no-cache":"force-cache"}}function A(e,t){return b(this,null,function*(){return Xe(e)?e:Te(e,R(T({},t),{autoDestruct:!0}))})}function Te(e,t){return b(this,null,function*(){var f,g,h,p;const{scale:n=1,workerUrl:r,workerNumber:a=1}=t||{},i=Boolean(t==null?void 0:t.debug),o=(f=e.ownerDocument)!=null?f:N?window.document:void 0,c=(h=(g=e.ownerDocument)==null?void 0:g.defaultView)!=null?h:N?window:void 0,s=new Map,l=R(T({width:0,height:0,quality:1,type:"image/png",scale:n,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:i,fetch:T({requestInit:mt((p=t==null?void 0:t.fetch)==null?void 0:p.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},t==null?void 0:t.fetch),font:{},drawImageInterval:100,workerUrl:null,workerNumber:a,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:gt(i),node:e,ownerDocument:o,ownerWindow:c,dpi:n===1?null:96*n,svgStyleElement:ve(o),svgDefsElement:o==null?void 0:o.createElementNS(O,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...new Array(He&&r&&a?a:0)].map(()=>{try{const y=new Worker(r);return y.onmessage=m=>b(this,null,function*(){var C,k,D,G;const{url:S,result:w}=m.data;w?(k=(C=s.get(S))==null?void 0:C.resovle)==null||k.call(C,w):(G=(D=s.get(S))==null?void 0:D.reject)==null||G.call(D,new Error(`Error receiving message from worker: ${S}`))}),y.onmessageerror=m=>{var w,C;const{url:S}=m.data;(C=(w=s.get(S))==null?void 0:w.reject)==null||C.call(w,new Error(`Error receiving message from worker: ${S}`))},y}catch(y){return E("Failed to new Worker",y),null}}).filter(Boolean),fontFamilies:new Set,fontCssTexts:new Map,acceptOfImage:`${[ct(o)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:s,drawImageCount:0,tasks:[]});l.log.time("wait until load"),yield Se(e,l.timeout),l.log.timeEnd("wait until load");const{width:u,height:d}=ht(e,l);return l.width=u,l.height=d,l})}function ve(e){if(!e)return;const t=e.createElement("style"),n=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(n),t}function ht(e,t){let{width:n,height:r}=t;if(v(e)&&(!n||!r)){const a=e.getBoundingClientRect();n=n||a.width||Number(e.getAttribute("width"))||0,r=r||a.height||Number(e.getAttribute("height"))||0}return{width:n,height:r}}function wt(e,t){return b(this,null,function*(){const{log:n,timeout:r,drawImageCount:a,drawImageInterval:i}=t;n.time("image to canvas");const o=yield P(e,{timeout:r}),{canvas:c,context2d:s}=pt(e.ownerDocument,t),l=()=>{try{s==null||s.drawImage(o,0,0,c.width,c.height)}catch(u){E("Failed to drawImage",u)}};l();for(let u=0;u<a;u++)yield new Promise(d=>{setTimeout(()=>{l(),d()},u+i)});return t.drawImageCount=0,n.timeEnd("image to canvas"),c})}function pt(e,t){const{width:n,height:r,scale:a,backgroundColor:i,maximumCanvasSize:o}=t,c=e.createElement("canvas");c.width=Math.floor(n*a),c.height=Math.floor(r*a),c.style.width=`${n}px`,c.style.height=`${r}px`,o&&(c.width>o||c.height>o)&&(c.width>o&&c.height>o?c.width>c.height?(c.height*=o/c.width,c.width=o):(c.width*=o/c.height,c.height=o):c.width>o?(c.height*=o/c.width,c.width=o):(c.width*=o/c.height,c.height=o));const s=c.getContext("2d");return s&&i&&(s.fillStyle=i,s.fillRect(0,0,c.width,c.height)),{canvas:c,context2d:s}}const yt=["width","height"],bt=["stroke","fill"];function Ae(e,t,n){var y;const{defaultComputedStyles:r,ownerDocument:a}=n,i=e.nodeName.toLowerCase(),o=I(e)&&i!=="svg",c=o?bt.map(m=>[m,e.getAttribute(m)]).filter(([,m])=>m!==null):[],s=[o&&"svg",i,c.map((m,S)=>`${m}=${S}`).join(","),t].filter(Boolean).join(":");if(r.has(s))return r.get(s);let l=n.sandbox;if(!l)try{a&&(l=a.createElement("iframe"),l.id=`__SANDBOX__-${Ee()}`,l.width="0",l.height="0",l.style.visibility="hidden",l.style.position="fixed",a.body.appendChild(l),(y=l.contentWindow)==null||y.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),n.sandbox=l)}catch(m){E("Failed to create iframe sandbox",m)}if(!l)return new Map;const u=l.contentWindow;if(!u)return new Map;const d=u.document;let f,g;o?(f=d.createElementNS(O,"svg"),g=f.ownerDocument.createElementNS(f.namespaceURI,i),c.forEach(([m,S])=>{g.setAttributeNS(null,m,S)}),f.appendChild(g)):f=g=d.createElement(i),g.textContent=" ",d.body.appendChild(f);const h=u.getComputedStyle(g,t),p=new Map;for(let m=h.length,S=0;S<m;S++){const w=h.item(S);yt.includes(w)||p.set(w,h.getPropertyValue(w))}return d.body.removeChild(f),r.set(s,p),p}function Ne(e,t){var i;const n=new Map,r=[],a=new Map;for(let o=e.length,c=0;c<o;c++){const s=e.item(c),l=e.getPropertyValue(s),u=e.getPropertyPriority(s),d=s.lastIndexOf("-"),f=d>-1?s.substring(0,d):void 0;if(f){let g=a.get(f);g||(g=new Map,a.set(f,g)),g.set(s,[l,u])}t.get(s)===l&&!u||(f?r.push(f):n.set(s,[l,u]))}for(let o=r.length,c=0;c<o;c++)(i=a.get(r[c]))==null||i.forEach((s,l)=>n.set(l,s));return n}const St=[":before",":after"],Et=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function Ct(e,t,n,r){const{ownerWindow:a,svgStyleElement:i,svgStyles:o}=r;if(!i||!a)return;function c(s){var m;const l=a.getComputedStyle(e,s);let u=l.getPropertyValue("content");if(!u||u==="none")return;u=u.replace(/(')|(")|(counter\(.+\))/g,"");const d=[Ee()],f=Ae(e,s,r),g=[`content: '${u}';`],h=Ne(l,f);if(h.delete("content"),h.delete("-webkit-locale"),((m=h.get("background-clip"))==null?void 0:m[0])==="text"&&t.classList.add("______background-clip--text"),h.forEach(([S,w],C)=>{g.push(`${C}: ${S}${w?" !important":""};`)}),g.length===1)return;try{t.className=[t.className,...d].join(" ")}catch(S){return}const p=g.join(`
  `);let y=o.get(p);y||(y=[],o.set(p,y)),y.push(`.${d[0]}:${s}`)}St.forEach(c),n&&Et.forEach(c)}function Tt(e,t){ee(e)&&(t.innerHTML=e.value),(ee(e)||et(e)||rt(e))&&t.setAttribute("value",e.value)}function vt(e,t,n,r){var l,u,d,f;const{ownerWindow:a}=r,i=t.style,o=a.getComputedStyle(e),c=Ae(e,null,r),s=Ne(o,c);return s.delete("transition-property"),s.delete("all"),s.delete("d"),s.delete("content"),n&&(s.delete("margin-top"),s.delete("margin-right"),s.delete("margin-bottom"),s.delete("margin-left"),s.delete("margin-block-start"),s.delete("margin-block-end"),s.delete("margin-inline-start"),s.delete("margin-inline-end"),s.set("box-sizing",["border-box",""])),((l=s.get("background-clip"))==null?void 0:l[0])==="text"&&t.classList.add("______background-clip--text"),ge&&(s.has("font-kerning")||s.set("font-kerning",["normal",""]),(((u=s.get("overflow-x"))==null?void 0:u[0])==="hidden"||((d=s.get("overflow-y"))==null?void 0:d[0])==="hidden")&&((f=s.get("text-overflow"))==null?void 0:f[0])==="ellipsis"&&e.scrollWidth===e.clientWidth&&s.set("text-overflow",["clip",""])),s.forEach(([g,h],p)=>{i.setProperty(p,g,h)}),s}function At(e,t){return b(this,null,function*(){var i,o,c;const{ownerDocument:n,svgDefsElement:r}=t,a=(o=(i=e.querySelectorAll)==null?void 0:i.call(e,"use"))!=null?o:[];if(a.length)for(let s=a.length,l=0;l<s;l++){const u=a[l],d=(c=u.getAttribute("xlink:href"))!=null?c:u.getAttribute("href");if(!d)continue;const f=n==null?void 0:n.querySelector(`svg ${d}`);!f||r!=null&&r.querySelector(d)||r==null||r.appendChild(yield W(f,t))}return e.cloneNode(!1)})}function Nt(e,t){var n;try{if((n=e==null?void 0:e.contentDocument)!=null&&n.body)return W(e.contentDocument.body,t)}catch(r){E("Failed to clone iframe",r)}return e.cloneNode(!1)}function xe(e){if(e.ownerDocument)try{const a=e.toDataURL();if(a!=="data:,")return x(a,e.ownerDocument)}catch(a){}const t=e.cloneNode(!1),n=e.getContext("2d"),r=t.getContext("2d");try{return n&&r&&r.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(a){E("Failed to clone canvas",a)}return t}function xt(e){return b(this,null,function*(){if(e.ownerDocument&&!e.currentSrc&&e.poster)return x(e.poster,e.ownerDocument);const t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);const n=t.ownerDocument;if(n){let r=!0;if(yield P(t,{onError:()=>r=!1}),!r)return e.poster?x(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,yield new Promise(i=>{t.addEventListener("seeked",i,{once:!0})});const a=n.createElement("canvas");a.width=e.offsetWidth,a.height=e.offsetHeight;try{const i=a.getContext("2d");i&&i.drawImage(t,0,0,a.width,a.height)}catch(i){return E("Failed to clone video",i),e.poster?x(e.poster,e.ownerDocument):t}return xe(a)}return t})}function It(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}function kt(e,t){return Ze(e)?xe(e):at(e)?Nt(e,t):F(e)?It(e):L(e)?xt(e):Je(e)?At(e,t):e.cloneNode(!1)}function te(e,t,n){return b(this,null,function*(){v(t)&&(tt(t)||nt(t))||n.filter&&!n.filter(t)||e.appendChild(yield W(t,n))})}function ne(e,t,n){return b(this,null,function*(){var a,i;const r=(i=v(e)?(a=e.shadowRoot)==null?void 0:a.firstChild:void 0)!=null?i:e.firstChild;for(let o=r;o;o=o.nextSibling)if(!Ke(o))if(v(o)&&ot(o)&&typeof o.assignedNodes=="function"){const c=o.assignedNodes();for(let s=0;s<c.length;s++)yield te(t,c[s],n)}else yield te(t,o,n)})}function Dt(e,t){const{backgroundColor:n,width:r,height:a,style:i}=t,o=e.style;if(n&&o.setProperty("background-color",n,"important"),r&&o.setProperty("width",`${r}px`,"important"),a&&o.setProperty("height",`${a}px`,"important"),i)for(const c in i)o[c]=i[c]}function W(e,t,n=!1){return b(this,null,function*(){var c,s,l,u;const{ownerDocument:r,ownerWindow:a,fontFamilies:i}=t;if(r&&Qe(e))return r.createTextNode(e.data);if(r&&a&&v(e)&&(X(e)||I(e))){const d=yield kt(e,t);d.removeAttribute('"');const f=vt(e,d,n,t);n&&Dt(d,t);const g=[(c=f.get("overflow-x"))==null?void 0:c[0],(s=f.get("overflow-y"))==null?void 0:s[1]];return Ct(e,d,g.includes("scroll")||(g.includes("auto")||g.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth),t),Tt(e,d),(u=Ce((l=f.get("font-family"))==null?void 0:l[0]))==null||u.forEach(h=>i.add(h)),L(e)||(yield ne(e,d,t)),d}const o=e.cloneNode(!1);return yield ne(e,o,t),o})}function Ie(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(t){}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}function Rt(e){const c=e,{url:t,timeout:n,responseType:r}=c,a=Z(c,["url","timeout","responseType"]),i=new AbortController,o=n?setTimeout(()=>i.abort(),n):void 0;return fetch(t,T({signal:i.signal},a)).then(s=>{if(!s.ok)throw new Error("Failed fetch, not 2xx response",{cause:s});switch(r){case"dataUrl":return s.blob().then(dt);case"text":default:return s.text()}}).finally(()=>clearTimeout(o))}function B(e,t){const{url:n,requestType:r="text",responseType:a="text",imageDom:i}=t;let o=n;const{timeout:c,acceptOfImage:s,requests:l,fetch:{requestInit:u,bypassingCache:d,placeholderImage:f},workers:g}=e;let h;if(l.has(n))h=l.get(n);else{d&&(o+=(/\?/.test(o)?"&":"?")+new Date().getTime()),r==="image"&&$&&e.drawImageCount++;const p=T({url:o,timeout:c,responseType:a,headers:r==="image"?{accept:s}:void 0},u);h={type:r,resovle:void 0,reject:void 0,response:null},h.response=(!$&&n.startsWith("http")&&g.length?new Promise((y,m)=>{g[l.size&g.length-1].postMessage(T({rawUrl:n},p)),h.resovle=y,h.reject=m}):Rt(p)).catch(y=>{if(l.delete(n),r==="image"&&f)return E("Failed to fetch image base64, trying to use placeholder image",o),typeof f=="string"?f:f(i);throw y}),l.set(n,h)}return h.response}function ke(e,t,n,r){return b(this,null,function*(){if(!De(e))return e;for(const[a,i]of Ft(e,t))try{const o=yield B(n,{url:i,requestType:r?"image":"text",responseType:"dataUrl"});e=e.replace(Pt(a),`$1${o}$3`)}catch(o){E("Failed to fetch css data url",a,o)}return e})}function De(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const Re=/url\((['"]?)([^'"]+?)\1\)/g;function Ft(e,t){const n=[];return e.replace(Re,(r,a,i)=>(n.push([i,we(i,t)]),r)),n.filter(([r])=>!V(r))}function Pt(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Ut(e,t){return b(this,null,function*(){const{ownerDocument:n,svgStyleElement:r,fontFamilies:a,fontCssTexts:i,tasks:o,font:c}=t;if(!(!n||!r||!a.size))if(c&&c.cssText){const s=oe(c.cssText,t);r.appendChild(n.createTextNode(`${s}
`))}else{const s=Array.from(n.styleSheets).filter(u=>{try{return"cssRules"in u&&Boolean(u.cssRules.length)}catch(d){return E(`Error while reading CSS rules from ${u.href}`,d),!1}});yield Promise.all(s.flatMap(u=>Array.from(u.cssRules).map((d,f)=>b(this,null,function*(){if(Ye(d)){let g=f+1;const h=d.href;let p="";try{p=yield B(t,{url:h,requestType:"text",responseType:"text"})}catch(m){E(`Error fetch remote css import from ${h}`,m)}const y=p.replace(Re,(m,S,w)=>m.replace(w,we(w,h)));for(const m of $t(y))try{u.insertRule(m,m.startsWith("@import")?g+=1:u.cssRules.length)}catch(S){E("Error inserting rule from remote css import",{rule:m,error:S})}}})))),s.flatMap(u=>Array.from(u.cssRules)).filter(u=>{var d;return Ge(u)&&De(u.style.getPropertyValue("src"))&&((d=Ce(u.style.getPropertyValue("font-family")))==null?void 0:d.some(f=>a.has(f)))}).forEach(u=>{const d=u,f=i.get(d.cssText);f?r.appendChild(n.createTextNode(`${f}
`)):o.push(ke(d.cssText,d.parentStyleSheet?d.parentStyleSheet.href:null,t).then(g=>{g=oe(g,t),i.set(d.cssText,g),r.appendChild(n.createTextNode(`${g}
`))}))})}})}const _t=/(\/\*[\s\S]*?\*\/)/gi,re=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function $t(e){if(e==null)return[];const t=[];let n=e.replace(_t,"");for(;;){const i=re.exec(n);if(!i)break;t.push(i[0])}n=n.replace(re,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,a=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let i=r.exec(n);if(i)a.lastIndex=r.lastIndex;else if(i=a.exec(n),i)r.lastIndex=a.lastIndex;else break;t.push(i[0])}return t}const Bt=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Lt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function oe(e,t){const{font:n}=t,r=n?n==null?void 0:n.preferredFormat:void 0;return r?e.replace(Lt,a=>{for(;;){const[i,,o]=Bt.exec(a)||[];if(!o)return"";if(o===r)return`src: ${i};`}}):e}function Mt(e,t){if(F(e)){const n=e.currentSrc||e.src;if(!V(n))return[B(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.srcset="",e.dataset.originalSrc=n,e.src=r||"")})];($||me)&&n.includes("data:image/svg+xml")&&t.drawImageCount++}else if(I(e)&&!V(e.href.baseVal)){const n=e.href.baseVal;return[B(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.dataset.originalSrc=n,e.href.baseVal=r||"")})]}return[]}const Ot=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Wt(e,t){return Ot.map(n=>{const r=e.getPropertyValue(n);return r?(($||me)&&r.includes("data:image/svg+xml")&&t.drawImageCount++,ke(r,null,t,!0).then(a=>{!a||r===a||e.setProperty(n,a,e.getPropertyPriority(n))})):null}).filter(Boolean)}function Fe(e,t){const{tasks:n}=t;v(e)&&(F(e)||he(e))&&n.push(...Mt(e,t)),X(e)&&n.push(...Wt(e.style,t)),e.childNodes.forEach(r=>{Fe(r,t)})}function Pe(e,t){return b(this,null,function*(){const n=yield A(e,t);if(v(n.node)&&I(n.node))return n.node;const{ownerDocument:r,log:a,tasks:i,svgStyleElement:o,svgDefsElement:c,svgStyles:s,font:l,progress:u,autoDestruct:d,onCloneNode:f,onEmbedNode:g,onCreateForeignObjectSvg:h}=n;a.time("clone node");const p=yield W(n.node,n,!0);if(o&&r){let C="";s.forEach((k,D)=>{C+=`${k.join(`,
`)} {
  ${D}
}
`}),o.appendChild(r.createTextNode(C))}a.timeEnd("clone node"),f==null||f(p),l!==!1&&v(p)&&(a.time("embed web font"),yield Ut(p,n),a.timeEnd("embed web font")),a.time("embed node"),Fe(p,n);const y=i.length;let m=0;const S=()=>b(this,null,function*(){for(;;){const C=i.pop();if(!C)break;try{yield C}catch(k){E("Failed to run task",k)}u==null||u(++m,y)}});u==null||u(m,y),yield Promise.all([...Array(4)].map(S)),a.timeEnd("embed node"),g==null||g(p);const w=jt(p,n);return c&&w.insertBefore(c,w.children[0]),o&&w.insertBefore(o,w.children[0]),d&&Ie(n),h==null||h(w),w})}function jt(e,t){const{width:n,height:r}=t,a=pe(n,r,e.ownerDocument),i=a.ownerDocument.createElementNS(a.namespaceURI,"foreignObject");return i.setAttributeNS(null,"x","0%"),i.setAttributeNS(null,"y","0%"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"height","100%"),i.append(e),a.appendChild(i),a}function j(e,t){return b(this,null,function*(){var o;const n=yield A(e,t),r=yield Pe(n),a=ye(r);n.autoDestruct||(n.svgStyleElement=ve(n.ownerDocument),n.svgDefsElement=(o=n.ownerDocument)==null?void 0:o.createElementNS(O,"defs"),n.svgStyles.clear());const i=x(a,r.ownerDocument);return yield wt(i,n)})}function qt(e,t){return b(this,null,function*(){const n=yield A(e,t),{log:r,type:a,quality:i,dpi:o}=n,c=yield j(n);r.time("canvas to blob");const s=yield lt(c,a,i);if(["image/png","image/jpeg"].includes(a)&&o){const l=yield ft(s.slice(0,33));let u=new Uint8Array(l);return a==="image/png"?u=de(u,o):a==="image/jpeg"&&(u=se(u,o)),new Blob([u,s.slice(33)],{type:a})}return r.timeEnd("canvas to blob"),s})}function U(e,t){return b(this,null,function*(){const n=yield A(e,t),{log:r,quality:a,type:i,dpi:o}=n,c=yield j(n);r.time("canvas to data url");let s=c.toDataURL(i,a);if(["image/png","image/jpeg"].includes(i)&&o&&fe&&ze){const[l,u]=s.split(",");let d=0,f=!1;if(i==="image/png"){const w=Ve(u);w>=0?(d=Math.ceil((w+28)/3)*4,f=!0):d=33/3*4}else i==="image/jpeg"&&(d=18/3*4);const g=u.substring(0,d),h=u.substring(d),p=window.atob(g),y=new Uint8Array(p.length);for(let w=0;w<y.length;w++)y[w]=p.charCodeAt(w);const m=i==="image/png"?de(y,o,f):se(y,o),S=window.btoa(String.fromCharCode(...m));s=[l,",",S,h].join("")}return r.timeEnd("canvas to data url"),s})}function Ue(e,t){return b(this,null,function*(){const n=yield A(e,t),{width:r,height:a,ownerDocument:i}=n,o=yield U(n),c=pe(r,a,i),s=c.ownerDocument.createElementNS(c.namespaceURI,"image");return s.setAttributeNS(null,"href",o),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"width","100%"),c.appendChild(s),ye(c)})}function Vt(e,t){return b(this,null,function*(){const n=yield A(e,t),{ownerDocument:r,width:a,height:i,scale:o,type:c}=n,s=c==="image/svg+xml"?yield Ue(n):yield U(n),l=x(s,r);return l.width=Math.floor(a*o),l.height=Math.floor(i*o),l.style.width=`${a}px`,l.style.height=`${i}px`,l})}function Ht(e,t){return b(this,null,function*(){return U(yield A(e,R(T({},t),{type:"image/jpeg"})))})}function zt(e,t){return b(this,null,function*(){const n=yield A(e,t),r=yield j(n);return r.getContext("2d").getImageData(0,0,r.width,r.height).data})}function Xt(e,t){return b(this,null,function*(){return U(yield A(e,R(T({},t),{type:"image/png"})))})}function Gt(e,t){return b(this,null,function*(){return U(yield A(e,R(T({},t),{type:"image/webp"})))})}exports.createContext=Te;exports.destroyContext=Ie;exports.domToBlob=qt;exports.domToCanvas=j;exports.domToDataUrl=U;exports.domToForeignObjectSvg=Pe;exports.domToImage=Vt;exports.domToJpeg=Ht;exports.domToPixel=zt;exports.domToPng=Xt;exports.domToSvg=Ue;exports.domToWebp=Gt;exports.loadMedia=P;exports.waitUntilLoad=Se;
